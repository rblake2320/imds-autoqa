<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AutoQA Test Page</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: system-ui, -apple-system, sans-serif;
      font-size: 16px;
      color: #222;
      background: #f4f6f9;
      line-height: 1.5;
    }

    nav {
      background: #1a1a2e;
      padding: 0.75rem 1.5rem;
      display: flex;
      align-items: center;
      gap: 1.5rem;
    }
    nav a {
      color: #e0e0e0;
      text-decoration: none;
      font-weight: 500;
    }
    nav a:hover { color: #ffffff; text-decoration: underline; }

    .container {
      max-width: 860px;
      margin: 2rem auto;
      padding: 0 1rem;
      display: grid;
      gap: 1.5rem;
    }

    .card {
      background: #ffffff;
      border: 1px solid #dde3ec;
      border-radius: 8px;
      padding: 1.25rem 1.5rem;
    }

    h1 { font-size: 1.5rem; color: #1a1a2e; margin-bottom: 0.25rem; }
    h2 { font-size: 1.1rem; color: #333; margin-bottom: 0.75rem; border-bottom: 1px solid #eee; padding-bottom: 0.4rem; }

    label { display: block; font-size: 0.9rem; font-weight: 600; margin-bottom: 0.3rem; color: #444; }

    input[type="text"],
    input[type="email"],
    input[type="password"],
    input[type="file"],
    textarea,
    select {
      width: 100%;
      padding: 0.5rem 0.75rem;
      border: 1px solid #bfc9d4;
      border-radius: 6px;
      font-size: 0.95rem;
      background: #fafbfc;
      margin-bottom: 0.75rem;
    }
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #4a90d9;
      box-shadow: 0 0 0 3px rgba(74, 144, 217, 0.15);
    }

    .btn {
      display: inline-block;
      padding: 0.5rem 1.1rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.95rem;
      font-weight: 600;
      transition: background 0.15s ease;
    }
    .btn-primary   { background: #4a90d9; color: #fff; }
    .btn-primary:hover { background: #3578c0; }
    .btn-danger    { background: #d94a4a; color: #fff; }
    .btn-danger:hover  { background: #b83838; }
    .btn-secondary { background: #6c757d; color: #fff; }
    .btn-secondary:hover { background: #565e64; }
    .btn-success   { background: #28a745; color: #fff; }
    .btn-success:hover   { background: #1e7e34; }

    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }

    /* Custom dropdown */
    .custom-dropdown { position: relative; display: inline-block; width: 100%; }
    .custom-dropdown .dropdown-toggle {
      width: 100%;
      padding: 0.5rem 0.75rem;
      border: 1px solid #bfc9d4;
      border-radius: 6px;
      background: #fafbfc;
      font-size: 0.95rem;
      cursor: pointer;
      text-align: left;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0;
    }
    .custom-dropdown .dropdown-menu {
      display: none;
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: #fff;
      border: 1px solid #bfc9d4;
      border-top: none;
      border-radius: 0 0 6px 6px;
      z-index: 100;
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .custom-dropdown .dropdown-menu.open { display: block; }
    .custom-dropdown .dropdown-menu li {
      padding: 0.5rem 0.75rem;
      cursor: pointer;
      font-size: 0.95rem;
    }
    .custom-dropdown .dropdown-menu li:hover { background: #f0f4ff; }
    .custom-dropdown .dropdown-menu li[aria-selected="true"] {
      background: #e8f0fe;
      font-weight: 600;
    }
    .custom-dropdown-wrapper { margin-bottom: 0.75rem; }

    /* Context menu target */
    .context-target {
      padding: 0.75rem 1rem;
      border: 2px dashed #bfc9d4;
      border-radius: 6px;
      color: #666;
      user-select: none;
      margin-bottom: 0.75rem;
    }

    /* Context menu popup */
    #context-menu {
      display: none;
      position: fixed;
      background: #fff;
      border: 1px solid #bfc9d4;
      border-radius: 6px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      z-index: 999;
      min-width: 150px;
    }
    #context-menu ul { list-style: none; padding: 0.25rem 0; }
    #context-menu li { padding: 0.4rem 1rem; cursor: pointer; font-size: 0.9rem; }
    #context-menu li:hover { background: #f0f4ff; }

    /* Iframe container */
    .iframe-container { border: 1px solid #bfc9d4; border-radius: 6px; overflow: hidden; }
    iframe { width: 100%; height: 200px; border: none; display: block; }

    /* Keyboard target */
    #keyboard-target {
      background: #fafbfc;
      border: 1px solid #bfc9d4;
      border-radius: 6px;
      padding: 0.5rem 0.75rem;
      min-height: 2.5rem;
      margin-bottom: 0.75rem;
      font-size: 0.95rem;
    }
    #keyboard-target:focus { outline: 2px solid #4a90d9; }

    /* Log area */
    #event-log {
      background: #1a1a2e;
      color: #a8d8a8;
      font-family: monospace;
      font-size: 0.8rem;
      padding: 0.75rem 1rem;
      border-radius: 6px;
      min-height: 80px;
      max-height: 150px;
      overflow-y: auto;
    }

    footer {
      background: #1a1a2e;
      color: #a0a8b8;
      text-align: center;
      padding: 1rem;
      margin-top: 2rem;
      font-size: 0.85rem;
    }

    .checkbox-group { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem; }
    .checkbox-group input[type="checkbox"] { width: auto; margin: 0; }
    .badge {
      display: inline-block;
      background: #4a90d9;
      color: #fff;
      font-size: 0.75rem;
      font-weight: 700;
      padding: 0.1rem 0.5rem;
      border-radius: 999px;
      vertical-align: middle;
      margin-left: 0.4rem;
    }
  </style>
</head>
<body>

<!-- Navigation (for HOVER tests) -->
<nav id="main-nav">
  <a href="#" id="nav-home">Home</a>
  <a href="#" id="nav-forms">Forms</a>
  <a href="#" id="nav-keyboard">Keyboard</a>
  <a href="#" id="nav-advanced">Advanced</a>
</nav>

<div class="container">

  <!-- Page title -->
  <div class="card">
    <h1>AutoQA Test Page <span class="badge">Phase 2B</span></h1>
    <p>A self-contained HTML page exercising all interaction types recorded by the AutoQA Chrome extension.</p>
  </div>

  <!-- ── 1. Basic form (INPUT, SELECT, CLICK, SUBMIT) ─────────────────── -->
  <div class="card" id="section-form">
    <h2>1. User Registration Form</h2>
    <form id="registration-form" onsubmit="handleFormSubmit(event)">

      <div class="form-row">
        <div>
          <label for="username">Username</label>
          <input type="text" id="username" name="username"
                 placeholder="Enter username" autocomplete="off">
        </div>
        <div>
          <label for="email">Email</label>
          <input type="email" id="email" name="email"
                 placeholder="user@example.com" autocomplete="off">
        </div>
      </div>

      <!-- PASSWORD field (tests InputHandler redaction) -->
      <label for="password">Password</label>
      <input type="password" id="password" name="password" placeholder="••••••••">

      <label for="country">Country</label>
      <select id="country" name="country">
        <option value="">-- Select country --</option>
        <option value="us">United States</option>
        <option value="uk">United Kingdom</option>
        <option value="ca">Canada</option>
        <option value="au">Australia</option>
        <option value="de">Germany</option>
        <option value="fr">France</option>
        <option value="jp">Japan</option>
      </select>

      <div class="checkbox-group">
        <input type="checkbox" id="terms" name="terms">
        <label for="terms" style="margin-bottom:0">I agree to the Terms of Service</label>
      </div>

      <label for="avatar">Profile Picture</label>
      <input type="file" id="avatar" name="avatar" accept="image/*">

      <button type="submit" id="submit-btn" class="btn btn-primary">Create Account</button>
    </form>
  </div>

  <!-- ── 2. Custom dropdown (custom SELECT handler path) ───────────────── -->
  <div class="card" id="section-custom-dropdown">
    <h2>2. Custom Dropdown (div-based)</h2>
    <label for="custom-lang-toggle">Preferred Language</label>
    <div class="custom-dropdown-wrapper">
      <div class="custom-dropdown" id="custom-lang-dropdown">
        <button id="custom-lang-toggle" class="dropdown-toggle btn btn-secondary"
                aria-haspopup="listbox" aria-expanded="false"
                onclick="toggleCustomDropdown('custom-lang-dropdown')">
          <span id="custom-lang-value">Select language…</span>
          <span>▾</span>
        </button>
        <ul class="dropdown-menu" role="listbox" id="custom-lang-menu">
          <li role="option" onclick="selectCustomOption('custom-lang-dropdown', 'custom-lang-value', this)">English</li>
          <li role="option" onclick="selectCustomOption('custom-lang-dropdown', 'custom-lang-value', this)">Spanish</li>
          <li role="option" onclick="selectCustomOption('custom-lang-dropdown', 'custom-lang-value', this)">French</li>
          <li role="option" onclick="selectCustomOption('custom-lang-dropdown', 'custom-lang-value', this)">German</li>
          <li role="option" onclick="selectCustomOption('custom-lang-dropdown', 'custom-lang-value', this)">Japanese</li>
        </ul>
      </div>
    </div>
    <p id="custom-lang-result" style="color:#666;font-size:0.9rem;margin-top:0.5rem"></p>
  </div>

  <!-- ── 3. Keyboard events (KEY_PRESS) ────────────────────────────────── -->
  <div class="card" id="section-keyboard">
    <h2>3. Keyboard Interaction</h2>
    <label for="keyboard-target">Keyboard test area (click here, then type)</label>
    <div id="keyboard-target" tabindex="0"
         contenteditable="true"
         onkeydown="logKeyEvent(event)"
         placeholder="Click here and press keys…">
    </div>
    <div style="display:flex;gap:0.5rem;flex-wrap:wrap">
      <button class="btn btn-secondary" onclick="document.getElementById('keyboard-target').focus()">
        Focus input
      </button>
      <button class="btn btn-secondary" onclick="document.getElementById('keyboard-target').textContent=''">
        Clear
      </button>
    </div>
  </div>

  <!-- ── 4. Alert / Confirm / Prompt buttons ───────────────────────────── -->
  <div class="card" id="section-alerts">
    <h2>4. Alert Dialogs</h2>
    <div style="display:flex;gap:0.75rem;flex-wrap:wrap">
      <button id="alert-btn" class="btn btn-danger"
              onclick="window.alert('AutoQA test alert — click OK to dismiss.')">
        Trigger alert()
      </button>
      <button id="confirm-btn" class="btn btn-secondary"
              onclick="handleConfirm()">
        Trigger confirm()
      </button>
      <button id="prompt-btn" class="btn btn-secondary"
              onclick="handlePrompt()">
        Trigger prompt()
      </button>
    </div>
    <p id="alert-result" style="margin-top:0.75rem;color:#444;font-size:0.9rem"></p>
  </div>

  <!-- ── 5. New window / WINDOW_SWITCH ─────────────────────────────────── -->
  <div class="card" id="section-window">
    <h2>5. Window Management</h2>
    <button id="new-window-btn" class="btn btn-primary"
            onclick="openNewWindow()">
      Open new window
    </button>
    <button id="new-tab-btn" class="btn btn-secondary"
            onclick="openNewTab()" style="margin-left:0.5rem">
      Open new tab
    </button>
    <p id="window-result" style="margin-top:0.75rem;color:#444;font-size:0.9rem"></p>
  </div>

  <!-- ── 6. Double-click target ─────────────────────────────────────────── -->
  <div class="card" id="section-double-click">
    <h2>6. Double-click &amp; Right-click</h2>
    <div id="double-click-target"
         class="context-target"
         ondblclick="handleDoubleClick(this)"
         oncontextmenu="showContextMenu(event)">
      Double-click me or right-click me
    </div>
    <p id="click-type-result" style="color:#444;font-size:0.9rem"></p>
  </div>

  <!-- Context menu (rendered on right-click) -->
  <div id="context-menu" role="menu">
    <ul>
      <li onclick="ctxAction('Copy')">Copy</li>
      <li onclick="ctxAction('Paste')">Paste</li>
      <li onclick="ctxAction('Inspect')">Inspect</li>
    </ul>
  </div>

  <!-- ── 7. Inline iframe (FRAME_SWITCH) ───────────────────────────────── -->
  <div class="card" id="section-iframe">
    <h2>7. Iframe Interaction</h2>
    <p style="color:#666;font-size:0.9rem;margin-bottom:0.75rem">
      The iframe below contains its own button and input — use FRAME_SWITCH events to interact inside it.
    </p>
    <div class="iframe-container">
      <iframe id="inner-frame" name="inner-frame"
              srcdoc="
<!DOCTYPE html>
<html lang='en'>
<head>
  <style>
    body { font-family: system-ui, sans-serif; padding: 1rem; background:#f9fafb; }
    button { padding: 0.4rem 0.9rem; background:#4a90d9; color:#fff; border:none; border-radius:5px; cursor:pointer; }
    input { padding:0.4rem 0.7rem; border:1px solid #bbb; border-radius:5px; margin-right:0.5rem; }
    #inner-result { margin-top:0.75rem; color:#333; font-size:0.9rem; }
  </style>
</head>
<body>
  <h4 style='margin-bottom:0.75rem'>Inside iframe</h4>
  <input type='text' id='iframe-input' placeholder='Type here (inside iframe)'>
  <button id='iframe-btn' onclick='document.getElementById(\"inner-result\").textContent=\"Button clicked at \" + new Date().toISOString()'>
    Click inside iframe
  </button>
  <div id='inner-result'></div>
</body>
</html>">
      </iframe>
    </div>
  </div>

  <!-- ── 8. Scroll target ───────────────────────────────────────────────── -->
  <div class="card" id="section-scroll">
    <h2>8. Scroll Target</h2>
    <p style="color:#666;font-size:0.9rem">
      The element below is a scroll target. Use a SCROLL event with
      <code>element.id = "scroll-target"</code>.
    </p>
    <div id="scroll-target"
         style="height:80px;background:linear-gradient(135deg,#667eea,#764ba2);
                border-radius:8px;display:flex;align-items:center;
                justify-content:center;color:#fff;font-weight:700;font-size:1.1rem">
      Scroll target element
    </div>
  </div>

  <!-- ── 9. Event log ───────────────────────────────────────────────────── -->
  <div class="card" id="section-log">
    <h2>9. Event Log</h2>
    <div id="event-log">Waiting for events…</div>
    <button class="btn btn-secondary" style="margin-top:0.75rem"
            onclick="clearLog()">Clear log</button>
  </div>

</div><!-- /.container -->

<footer id="page-footer">
  AutoQA Test Page &bull; Phase 2B &bull; All interaction types covered
</footer>

<!-- ── JavaScript ──────────────────────────────────────────────────────── -->
<script>
  // ── Logging helper ──────────────────────────────────────────────────────
  function log(msg) {
    const el = document.getElementById('event-log');
    const ts = new Date().toISOString().substring(11, 23);
    el.textContent = '[' + ts + '] ' + msg + '\n' + el.textContent;
  }
  function clearLog() {
    document.getElementById('event-log').textContent = 'Log cleared.';
  }

  // ── Form submit ─────────────────────────────────────────────────────────
  function handleFormSubmit(e) {
    e.preventDefault();
    const username = document.getElementById('username').value;
    log('Form submitted — username: ' + (username || '(empty)'));
  }

  // ── Alert / Confirm / Prompt ─────────────────────────────────────────────
  function handleConfirm() {
    const result = window.confirm('Proceed with the action?');
    const el = document.getElementById('alert-result');
    el.textContent = 'confirm() returned: ' + result;
    log('confirm() returned: ' + result);
  }

  function handlePrompt() {
    const result = window.prompt('Enter your name:', 'AutoQA');
    const el = document.getElementById('alert-result');
    el.textContent = result !== null
      ? 'prompt() returned: "' + result + '"'
      : 'prompt() was cancelled';
    log('prompt() returned: ' + result);
  }

  // ── Custom dropdown ─────────────────────────────────────────────────────
  function toggleCustomDropdown(dropdownId) {
    const dropdown = document.getElementById(dropdownId);
    const menu = dropdown.querySelector('.dropdown-menu');
    const toggle = dropdown.querySelector('.dropdown-toggle');
    const isOpen = menu.classList.contains('open');
    // Close all dropdowns first
    document.querySelectorAll('.dropdown-menu.open').forEach(m => m.classList.remove('open'));
    document.querySelectorAll('.dropdown-toggle[aria-expanded="true"]')
      .forEach(t => t.setAttribute('aria-expanded', 'false'));
    if (!isOpen) {
      menu.classList.add('open');
      toggle.setAttribute('aria-expanded', 'true');
    }
  }

  function selectCustomOption(dropdownId, valueId, li) {
    const dropdown = document.getElementById(dropdownId);
    const valueEl  = document.getElementById(valueId);
    const menu     = dropdown.querySelector('.dropdown-menu');
    const toggle   = dropdown.querySelector('.dropdown-toggle');

    // Update selection
    menu.querySelectorAll('li').forEach(item => item.removeAttribute('aria-selected'));
    li.setAttribute('aria-selected', 'true');
    valueEl.textContent = li.textContent.trim();
    toggle.setAttribute('aria-expanded', 'false');
    menu.classList.remove('open');

    document.getElementById('custom-lang-result').textContent =
      'Selected: ' + li.textContent.trim();
    log('Custom dropdown selected: ' + li.textContent.trim());
  }

  // Close custom dropdowns when clicking outside
  document.addEventListener('click', function(e) {
    if (!e.target.closest('.custom-dropdown')) {
      document.querySelectorAll('.dropdown-menu.open').forEach(m => m.classList.remove('open'));
      document.querySelectorAll('.dropdown-toggle[aria-expanded="true"]')
        .forEach(t => t.setAttribute('aria-expanded', 'false'));
    }
  });

  // ── Double-click ────────────────────────────────────────────────────────
  function handleDoubleClick(el) {
    el.style.background = '#d4edda';
    document.getElementById('click-type-result').textContent =
      'Double-click detected at ' + new Date().toISOString();
    log('Double-click detected');
  }

  // ── Context menu ────────────────────────────────────────────────────────
  document.addEventListener('contextmenu', function(e) {
    const target = e.target.closest('#double-click-target');
    if (!target) return;
    e.preventDefault();
    const menu = document.getElementById('context-menu');
    menu.style.display = 'block';
    menu.style.left = e.clientX + 'px';
    menu.style.top  = e.clientY + 'px';
    log('Context menu opened at (' + e.clientX + ', ' + e.clientY + ')');
  });

  document.addEventListener('click', function() {
    document.getElementById('context-menu').style.display = 'none';
  });

  function ctxAction(action) {
    document.getElementById('click-type-result').textContent =
      'Context menu action: ' + action;
    log('Context menu action: ' + action);
    document.getElementById('context-menu').style.display = 'none';
  }

  // ── New window / tab ────────────────────────────────────────────────────
  function openNewWindow() {
    const w = window.open('about:blank', 'autoqa-new-window',
      'width=640,height=480,menubar=no,toolbar=no,status=no');
    if (w) {
      w.document.write(
        '<html><head><title>AutoQA New Window</title></head>' +
        '<body style="font-family:system-ui;padding:2rem">' +
        '<h1>AutoQA New Window</h1>' +
        '<p>This window was opened by the test page.</p>' +
        '<button onclick="window.close()">Close this window</button>' +
        '</body></html>'
      );
      document.getElementById('window-result').textContent =
        'New window opened at ' + new Date().toISOString();
      log('New window opened');
    } else {
      log('Pop-up blocked — new window not opened');
    }
  }

  function openNewTab() {
    window.open('about:blank', '_blank');
    document.getElementById('window-result').textContent =
      'New tab opened at ' + new Date().toISOString();
    log('New tab opened');
  }

  // ── Keyboard event logger ───────────────────────────────────────────────
  function logKeyEvent(e) {
    log('KeyDown: key=' + e.key + ' code=' + e.code +
        (e.ctrlKey  ? ' +Ctrl'  : '') +
        (e.shiftKey ? ' +Shift' : '') +
        (e.altKey   ? ' +Alt'   : '') +
        (e.metaKey  ? ' +Meta'  : ''));
  }
</script>
</body>
</html>
